import{g as j,h as _,q as S,y as E,$ as q,u as m,F as h,C as g,i as T,T as f,a as O,b as L,k as A,r as H,c as I,d as M,o as w,O as C}from"./stylex-K6Pfmy25.js";const B=()=>document.querySelector("cart-drawer"),N=()=>{var e;return(e=document.querySelector(".order-value-booster-side-cart"))==null?void 0:e.parentElement},$=()=>{const e=document.querySelectorAll("cart-notification .cart-notification__links");return e[e.length-1]},G=()=>{const e=document.querySelectorAll(".side-cart");return e[e.length-1]},U=()=>document.querySelector('form[action$="/cart"]'),Q=()=>document.querySelector(".essential-upsell-side-cart"),V=()=>{const e=document.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom");return e?e.parentElement:null},P=()=>Q()||V()||N()||$()||G()||U(),p=()=>B()||P(),Y=({defaultPlacementSelectors:e})=>{for(const t of e){const r=document.querySelector(t);if(r)return r}return null},x=({isFallbackActive:e})=>e?j()||document.querySelector("product-info"):null,z=({defaultPlacementSelectors:e,isFallbackActive:t})=>Y({defaultPlacementSelectors:e})||x({isFallbackActive:t}),J=({setPortalContainer:e,defaultPlacementSelectors:t,isFallbackActive:r})=>{const l=z({defaultPlacementSelectors:t,isFallbackActive:r});return l?(e(l),()=>{e(null)}):null},k=({selectors:e})=>e.map(t=>Array.from(document.querySelectorAll(t))).flat(),R=({appBlockSelectors:e,manualBlockSelectors:t,defaultPlacementSelectors:r,isFallbackActive:l})=>{const[o,n]=_(null),s=S(()=>{const i=p(),c=k({selectors:e});return Array.from(c).some(d=>i?!i.contains(d):!0)?null:J({setPortalContainer:n,defaultPlacementSelectors:r,isFallbackActive:l})},[e,r,l]),u=S(()=>{const i=p(),a=k({selectors:t}).find(d=>i?!i.contains(d):!1);if(a){n(a);return}return s()},[s,t]);return E(u,[u]),{productPagePortalContainer:o}},K=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:o})=>{const{productPagePortalContainer:n}=R({appBlockSelectors:["essential-upsell-cross-sell-app-block"],manualBlockSelectors:[".essential-upsell-cross-sell-block",".essential-upsell-block"],defaultPlacementSelectors:[".essential-upsell-cross-sell-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!t});return n?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:o}),n):null},W=()=>document.querySelector("cart-items.page-width")||document.querySelector("cart-items .page-width")||document.querySelector("cart-items"),v=({funnel:e,element:t,setPortalContainer:r})=>{const l=document.createElement("div");return e.placement.cartPagePositionType===g.TOP_OF_THE_CART?t.prepend(l):e.placement.cartPagePositionType===g.BOTTOM_OF_THE_CART&&t.append(l),r(l),()=>{r(null),l.remove()}},D=({funnel:e,element:t,setPortalContainer:r})=>{if(e.placement.cartPagePositionType===g.TOP_OF_THE_CART){const l=t.querySelector(".essential-upsell-side-cart-top");if(l)return r(l),()=>{r(null)};if(t.querySelector("cart-drawer-items.is-empty")){r(null);return}const o=t.querySelector("cart-drawer-items:not(.is-empty)")||t.querySelector(".drawer__scrollable");if(o){const s=document.createElement("div");return o.append(s),r(s),()=>{r(null),s.remove()}}const n=document.createElement("div");return t.prepend(n),r(n),()=>{r(null),n.remove()}}else if(e.placement.cartPagePositionType===g.BOTTOM_OF_THE_CART){const l=t.querySelector(".essential-upsell-side-cart-bottom");if(l)return r(l),()=>{r(null)};const o=t.querySelector(".drawer__footer");if(o){const s=document.createElement("div");return o.prepend(s),r(s),()=>{r(null),s.remove()}}const n=document.createElement("div");return t.append(n),r(n),()=>{r(null),n.remove()}}},X=()=>{if(!T())return null;const e=document.querySelectorAll('form[action$="/cart"]'),t=e[e.length-1];return t?t.parentNode:null},Z=({funnel:e,setPortalContainer:t})=>{const r=W();if(r)return v({funnel:e,element:r,setPortalContainer:t});const l=B();if(l)return D({funnel:e,element:l,setPortalContainer:t});const o=X();if(o)return v({funnel:e,element:o,setPortalContainer:t});const n=P();if(n)return D({funnel:e,element:n,setPortalContainer:t})},ee=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:o})=>{const[n,s]=_(null),u=S(()=>{const c=T()?document:p();return c&&c.querySelector("essential-upsell-cross-sell-app-block")?null:Z({funnel:e,setPortalContainer:s})},[e]),i=S(()=>{const c=T()?document:p(),a=c&&(c.querySelector(".essential-upsell-cross-sell-block")||c.querySelector(".essential-upsell-block"));if(a){s(a);return}return u()},[u]);return E(i,[i]),E(()=>{if(!n)return;const c=new MutationObserver(a=>{a.some(F=>Array.from(F.removedNodes).some(b=>b.contains(n)))&&(s(null),n.remove(),i())});return c.observe(document.body,{childList:!0,subtree:!0}),()=>{c.disconnect()}},[i,n]),E(()=>{if(n)return;const c=p();if(!c)return;const a=new MutationObserver(d=>{d.some(b=>Array.from(b.addedNodes).some(y=>!(y instanceof Element)||!y.querySelector?!1:!!y.querySelector("cart-drawer-items:not(.is-empty)")||!!y.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom")))&&u()});return a.observe(c,{childList:!0,subtree:!0}),()=>{a.disconnect()}},[u,n]),n?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:o}),n):null},te=({funnels:e,productPageProduct:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:o,shopMoneyFormat:n})=>{const s=f(()=>O({funnels:e,productPageProduct:t,productPageCollectionIds:r}),[e,t,r]),u=f(()=>L({funnels:e,cartItems:l}),[e,l]);return m(A,{children:[s&&m(K,{funnel:s,productPageProduct:t,cartItems:l,firstShopProductId:o,shopMoneyFormat:n}),u&&m(ee,{funnel:u,productPageProduct:t,cartItems:l,firstShopProductId:o,shopMoneyFormat:n})]})},re=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:o})=>{const{productPagePortalContainer:n}=R({appBlockSelectors:["essential-upsell-frequently-bought-together-app-block"],manualBlockSelectors:[".essential-upsell-frequently-bought-together-block"],defaultPlacementSelectors:[".essential-upsell-frequently-bought-together-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!t});return n?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:o}),n):null},ne=({funnels:e,productPageProduct:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:o,shopMoneyFormat:n})=>{const s=f(()=>O({funnels:e,productPageProduct:t,productPageCollectionIds:r}),[e,t,r]);return s?m(re,{funnel:s,productPageProduct:t,cartItems:l,firstShopProductId:o,shopMoneyFormat:n}):null},le=e=>{const{funnels:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:o,productPageProduct:n,shopMoneyFormat:s}=I({liquidProps:e}),{cartItems:u}=M({liquidCartItems:l}),i=f(()=>t.filter(a=>w({funnel:a})===C.FREQUENTLY_BOUGHT_TOGETHER),[t]),c=f(()=>t.filter(a=>w({funnel:a})===C.CROSS_SELL),[t]);return m(A,{children:[m(ne,{funnels:i,productPageProduct:n,productPageCollectionIds:r,cartItems:u,firstShopProductId:o,shopMoneyFormat:s}),m(te,{funnels:c,productPageProduct:n,productPageCollectionIds:r,cartItems:u,firstShopProductId:o,shopMoneyFormat:s})]})};H(le,"essential-upsell-app-embed",["upsellAppData","productPageProduct","productPageCollectionIds","cartItems","firstShopProductId","shopMoneyFormat"]);
