import{g as j,h as _,q as S,y as E,$ as q,u as m,F as h,C as g,i as T,T as f,a as O,b as L,k as A,r as H,c as M,d as N,o as w,O as k}from"./stylex-9DS1jsY4.js";const B=()=>document.querySelector("cart-drawer"),$=()=>{var e;return(e=document.querySelector(".order-value-booster-side-cart"))==null?void 0:e.parentElement},I=()=>{const e=document.querySelectorAll("cart-notification .cart-notification__links");return e[e.length-1]},G=()=>{const e=document.querySelectorAll(".side-cart");return e[e.length-1]},U=()=>document.querySelector('form[action$="/cart"]'),Q=()=>document.querySelector(".essential-upsell-side-cart"),V=()=>{const e=document.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom");return e?e.parentElement:null},P=()=>Q()||V()||$()||I()||G()||U(),p=()=>B()||P(),Y=({defaultPlacementSelectors:e})=>{for(const t of e){const r=document.querySelector(t);if(r)return r}return null},x=({isFallbackActive:e})=>e?j()||document.querySelector("product-info"):null,z=({defaultPlacementSelectors:e,isFallbackActive:t})=>Y({defaultPlacementSelectors:e})||x({isFallbackActive:t}),J=({setPortalContainer:e,defaultPlacementSelectors:t,isFallbackActive:r})=>{const l=z({defaultPlacementSelectors:t,isFallbackActive:r});return l?(e(l),()=>{e(null)}):null},C=({selectors:e})=>e.map(t=>Array.from(document.querySelectorAll(t))).flat(),R=({appBlockSelectors:e,manualBlockSelectors:t,defaultPlacementSelectors:r,isFallbackActive:l})=>{const[s,n]=_(null),o=S(()=>{const i=p(),c=C({selectors:e});return Array.from(c).some(d=>i?!i.contains(d):!0)?null:J({setPortalContainer:n,defaultPlacementSelectors:r,isFallbackActive:l})},[e,r,l]),u=S(()=>{const i=p(),a=C({selectors:t}).find(d=>i?!i.contains(d):!1);if(a){n(a);return}return o()},[o,t]);return E(u,[u]),{productPagePortalContainer:s}},K=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s})=>{const{productPagePortalContainer:n}=R({appBlockSelectors:["essential-upsell-cross-sell-app-block"],manualBlockSelectors:[".essential-upsell-cross-sell-block",".essential-upsell-block"],defaultPlacementSelectors:[".essential-upsell-cross-sell-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!t});return n?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s}),n):null},W=()=>document.querySelector("cart-items.page-width")||document.querySelector("cart-items .page-width")||document.querySelector("cart-items"),v=({funnel:e,element:t,setPortalContainer:r})=>{const l=document.createElement("div");return e.placement.cartPagePositionType===g.TOP_OF_THE_CART?t.prepend(l):e.placement.cartPagePositionType===g.BOTTOM_OF_THE_CART&&t.append(l),r(l),()=>{r(null),l.remove()}},D=({funnel:e,element:t,setPortalContainer:r})=>{if(e.placement.cartPagePositionType===g.TOP_OF_THE_CART){const l=t.querySelector(".essential-upsell-side-cart-top");if(l)return r(l),()=>{r(null)};if(t.querySelector("cart-drawer-items.is-empty")){r(null);return}const s=t.querySelector("cart-drawer-items:not(.is-empty)")||t.querySelector(".drawer__scrollable");if(s){const o=document.createElement("div");return s.append(o),r(o),()=>{r(null),o.remove()}}const n=document.createElement("div");return t.prepend(n),r(n),()=>{r(null),n.remove()}}else if(e.placement.cartPagePositionType===g.BOTTOM_OF_THE_CART){const l=t.querySelector(".essential-upsell-side-cart-bottom");if(l)return r(l),()=>{r(null)};const s=t.querySelector(".drawer__footer");if(s){const o=document.createElement("div");return s.prepend(o),r(o),()=>{r(null),o.remove()}}const n=document.createElement("div");return t.append(n),r(n),()=>{r(null),n.remove()}}},X=()=>{if(!T())return null;const e=document.querySelectorAll('form[action$="/cart"]'),t=e[e.length-1];return t?t.parentNode:null},Z=({funnel:e,setPortalContainer:t})=>{const r=W();if(r)return v({funnel:e,element:r,setPortalContainer:t});const l=B();if(l)return D({funnel:e,element:l,setPortalContainer:t});const s=X();if(s)return v({funnel:e,element:s,setPortalContainer:t});const n=P();if(n)return D({funnel:e,element:n,setPortalContainer:t})},ee=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s})=>{const[n,o]=_(null),u=S(()=>{const c=T()?document:p();return c&&c.querySelector("essential-upsell-cross-sell-app-block")?null:Z({funnel:e,setPortalContainer:o})},[e]),i=S(()=>{const c=T()?document:p(),a=c&&(c.querySelector(".essential-upsell-cross-sell-block")||c.querySelector(".essential-upsell-block"));if(a){o(a);return}return u()},[u]);return E(i,[i]),E(()=>{if(!n)return;const c=new MutationObserver(a=>{a.some(F=>Array.from(F.removedNodes).some(b=>b.contains(n)))&&(o(null),n.remove(),i())});return c.observe(document.body,{childList:!0,subtree:!0}),()=>{c.disconnect()}},[i,n]),E(()=>{if(n)return;const c=p();if(!c)return;const a=new MutationObserver(d=>{d.some(b=>Array.from(b.addedNodes).some(y=>!(y instanceof Element)||!y.querySelector?!1:!!y.querySelector("cart-drawer-items:not(.is-empty)")||!!y.querySelector(".essential-upsell-side-cart-top, .essential-upsell-side-cart-bottom")))&&u()});return a.observe(c,{childList:!0,subtree:!0}),()=>{a.disconnect()}},[u,n]),n?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s}),n):null},te=({funnels:e,productPageProduct:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:s,shopMoneyFormat:n})=>{const o=f(()=>O({funnels:e,productPageProduct:t,productPageCollectionIds:r}),[e,t,r]),u=f(()=>L({funnels:e,cartItems:l}),[e,l]);return m(A,{children:[o&&m(K,{funnel:o,productPageProduct:t,cartItems:l,firstShopProductId:s,shopMoneyFormat:n}),u&&m(ee,{funnel:u,productPageProduct:t,cartItems:l,firstShopProductId:s,shopMoneyFormat:n})]})},re=({funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s,productPageCollectionIds:n})=>{const{productPagePortalContainer:o}=R({appBlockSelectors:["essential-upsell-frequently-bought-together-app-block"],manualBlockSelectors:[".essential-upsell-frequently-bought-together-block"],defaultPlacementSelectors:[".essential-upsell-frequently-bought-together-default-placement",".essential-upsell-default-placement"],isFallbackActive:!!t});return o?q(m(h,{funnel:e,productPageProduct:t,cartItems:r,firstShopProductId:l,shopMoneyFormat:s,productPageCollectionIds:n}),o):null},ne=({funnels:e,productPageProduct:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:s,shopMoneyFormat:n})=>{const o=f(()=>O({funnels:e,productPageProduct:t,productPageCollectionIds:r}),[e,t,r]);return o?m(re,{funnel:o,productPageProduct:t,cartItems:l,firstShopProductId:s,shopMoneyFormat:n,productPageCollectionIds:r}):null},le=e=>{const{funnels:t,productPageCollectionIds:r,cartItems:l,firstShopProductId:s,productPageProduct:n,shopMoneyFormat:o}=M({liquidProps:e}),{cartItems:u}=N({liquidCartItems:l}),i=f(()=>t.filter(a=>w({funnel:a})===k.FREQUENTLY_BOUGHT_TOGETHER),[t]),c=f(()=>t.filter(a=>w({funnel:a})===k.CROSS_SELL),[t]);return m(A,{children:[m(ne,{funnels:i,productPageProduct:n,productPageCollectionIds:r,cartItems:u,firstShopProductId:s,shopMoneyFormat:o}),m(te,{funnels:c,productPageProduct:n,productPageCollectionIds:r,cartItems:u,firstShopProductId:s,shopMoneyFormat:o})]})};H(le,"essential-upsell-app-embed",["upsellAppData","productPageProduct","productPageCollectionIds","cartItems","firstShopProductId","shopMoneyFormat"]);
